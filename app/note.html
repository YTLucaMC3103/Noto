<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Noto – New Note</title>
  <link rel="stylesheet" href="app.css"/>
  <link rel="icon" href="../pics/logo.png" />
  <script src="https://kit.fontawesome.com/ffe64b8fe2.js" crossorigin="anonymous"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script src="../firebase.js"></script>
  <script src="note.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const pagesToggle = document.getElementById("pages-toggle");
      const feedbackToggle = document.getElementById("feedback-toggle");
      const applyToggle = document.getElementById("apply-toggle");
      const applyModal = document.getElementById("apply-modal");
      const feedbackModal = document.getElementById("feedback-modal");
      const modalClose = document.getElementById("modal-close");
      const subNav = document.getElementById("sub-nav");
      const profileToggle = document.getElementById("profile-toggle");
      const profileModal = document.getElementById("profile-modal");
      const trashToggle = document.getElementById("trash-toggle");
      const trashModal = document.getElementById("trash-modal");

      pagesToggle.addEventListener("click", (e) => {
        e.preventDefault();
        subNav.classList.toggle("active");
      });

      modalClose.addEventListener("click", (e) => {
        e.preventDefault();
        feedbackModal.classList.add("active");
      });

      feedbackToggle.addEventListener("click", (e) => {
        e.preventDefault();
        feedbackModal.classList.toggle("hidden");
      });

      profileToggle.addEventListener("click", (e) => {
        e.preventDefault();
        profileModal.classList.toggle("hidden");
      });

      applyToggle.addEventListener("click", (e) => {
        e.preventDefault();
        applyModal.classList.toggle("hidden");
      });

      trashToggle.addEventListener("click", (e) => {
        e.preventDefault();
        trashModal.classList.toggle("hidden");
      });

      firebase.auth().onAuthStateChanged(user => {
        const profileImg = document.getElementById("profile-img");

        if (profileImg) {
          if (user) {
            const photoURL = user.photoURL || "https://ui-avatars.com/api/?name=User&background=random";
            profileImg.src = photoURL;
            profileImg.style.display = "block";

            // ✅ Lade Notes erst nach erfolgreichem Login
            loadUserNotes(user);
          } else {
            profileImg.style.display = "none";
          }
        } else {
          console.warn("⚠️ Element #profile-img nicht im DOM gefunden.");
        }

        // Falls user nicht eingeloggt ist, trotzdem Notes-Bereich leeren
        if (!user) {
          const container = document.getElementById("notes-container");
          if (container) container.innerHTML = "<p>Please log in to see your notes.</p>";
        }
      });
    });
  </script>
</head>
<body>
    <nav class="navbar">
        <div class="nav-left">
            <a href="#" id="pages-toggle">pages</a>
            <a href="#" id="trash-toggle">trash</a>
            <a href="#" id="feedback-toggle">feedback</a>
            <a href="#" id="apply-toggle">become part of our team</a>
        </div>

        <div class="nav-center" onclick="navigate('home')" style="cursor: pointer;">
            <img src="/pics/logo.png" alt="">
        </div>
        
        <div class="nav-right">
            <button id="search-btn"><i class="fa-solid fa-magnifying-glass"></i></button>
            <img id="profile-img" alt="Profile" />
            <div id="profile-menu" class="hidden">
                <ul>
                    <li id="profile-toggle">Mein Profil</li>
                    <li onclick="logout()">Logout</li>
                </ul>
            </div>
        </div>

        <div class="sub-nav" id="sub-nav">

        </div>
    </nav>
  <div class="editor">
    <input type="text" id="note-title" placeholder="Note title..." oninput="autoSaveNote()" />
    <textarea id="note-content" placeholder="Start writing, your work is saved automatically." oninput="autoSaveNote()"></textarea>
    <div class="editor-actions">
    </div>
  </div>

  <div id="snackbar"></div>

  <div id="note-modal" class="note-modal hidden">
    <div class="note-modal-content">
      <span id="modal-close" class="modal-close"><i class="fa-solid fa-x"></i></span>
      <h2 id="modal-title">Note Title</h2>
      <p id="modal-created">Created: –</p>
      <p id="modal-updated">Updated: –</p>
      <div class="modal-actions">
        <button id="edit-note-btn"><i class="fa-solid fa-pencil"></i> Edit</button>
        <button id="delete-note-btn"><i class="fa-solid fa-trash-can"></i> Delete</button>
      </div>
    </div>
  </div>

  <div id="feedback-modal" class="feedback-modal hidden">
    <div class="feedback-modal-content">
      <h1 id="modal-title">Feedback</h1>
      <p>Your feedback is important to us!</p>
      <p>If you have some feedback, <strong>please let us know!</strong></p>
      <div class="email-container">
        <i onclick="copyEmailToClipboard()" class="fa-solid fa-copy"></i>
        <span id="email-address">noto.by.romano@gmail.com</span>
      </div>
    </div>
  </div>

  <div id="apply-modal" class="apply-modal hidden">
    <div class="apply-modal-content">
      <h1 id="modal-title">become part of our team</h1>
      <p>Do you wanna become part of our team?</p>
      <p>We are searching for talented individuals to join us.</p>
      <p>If you are interested, please reach out to us via email.</p>
      <p>Just write "<strong>Application for a new part of the team</strong>" in the header.</p>
      <div class="email-container">
        <i onclick="copyEmailToClipboard()" class="fa-solid fa-copy"></i>
        <span id="email-address">noto.by.romano@gmail.com</span>
      </div>
    </div>
  </div>

  <div id="trash-modal" class="trash-modal hidden">
    <div class="trash-modal-content">
      <h1 id="modal-title">Trash</h1>
      <p>Your deleted notes will appear here. They'll be permanently deleted after 30 days.</p>
      <div class="trash-notes-container">
        <p id="trash-empty-message">Your trash is empty.</p>
        <div id="trash-notes-list"></div>
      </div>
    </div>
  </div>
  
  <div id="profile-modal" class="profile-modal hidden">
    <div class="profile-modal-content">
    </div>
  </div>

</body>
</html>